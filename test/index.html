<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    <title>firerest test</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/phi-jp/meltline@v0.1.13/meltline.css">
  </head>
  <body>
    <main class='p32 container'>
      <h1 class='mb32'>firerest test</h1>

      <div class='mb16'>
        <button id='$postButton' class='button'>POST</button>
        <button id='$putButton' class='button'>PUT</button>
        <button id='$deleteButton' class='button'>DELETE</button>
      </div>

      <div>
        <div id='$posts'></div>
      </div>
    </main>
  </body>
</html>

<script src='../dist/index.js'></script>
<script>

let api = firerest.create({
  baseURL: 'https://jsonplaceholder.typicode.com/',
  debug: true,
});

api.on('prefetch', ({path, type}) => {
  console.log('prefetch', type, path);
});

api.on('postfetch', ({path, type}) => {
  console.log('postfetch', type, path);
});

api.on('fail', (params) => {
  // TODO: 
  console.log(params);
});

window.onload = async () => {
  let posts = await api.child('posts').get();
  console.log(posts);

  posts.forEach(post => {
    $posts.innerHTML += `<div class='mb16'>
      <h3 class='fs16 mb8'>${post.title}</h3>
      <p class='fs13'>${post.body}</p>
    </div>`;
  });

  $postButton.onclick = () => {
    api.child('posts').post({
      title: 'Hello, firerest!',
      description: 'post test',
    });
  };

  $putButton.onclick = () => {
    api.child('posts').child(2).put({
      title: 'Hello, firerest!',
      description: 'put test',
    });
  };

  $deleteButton.onclick = () => {
    api.child('posts').child(2).del({
      title: 'Hello, firerest!',
      description: 'delete test',
    });
  };
};

</script>